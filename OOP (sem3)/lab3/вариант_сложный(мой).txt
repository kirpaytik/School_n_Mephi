Вариант D Защитные башни. Магическое оружие (1.4)

В данной игре поджанра Tower Defence игровой процесс происходит на местности, покрытой дорогой, полями и лесами.
Враги, порождаемые расположенными на карте логовами, пытаются по дороге добраться до замка игрока и нанести ему урон.
Цель врагов - уничтожить замок, цель игрока - не позволить им это сделать.

Для защиты замка игрок может за золото установить на карте следующие виды башен^3: простая башня, магическая башня, магическая ловушка.
Простая и магическая башни наносят урон врагам попавшим в радиус действия в соответствии с установленной стратегией:
ближайший к башне, ближайший к замку, наиболее слабый, наиболее сильный, наиболее быстрый и т. п.
Башни могут быть построены только в поле.
Магическая башня при попадании во врага не только наносит урон, но и накладывает на него некоторый магический эффект.
Магическая ловушка устанавливается на дороге и срабатывает при наступании на неё врага.
При срабатывании ловушки, на всех врагов в определённом радиусе накладывается магический эффект.

Каждый наложенный магический эффект имеет некоторую величину эффекта (показатель силы эффекта) и время действия.
Существуют следующие типы магических эффектов: замедление (скорость передвижения врага уменьшается на процент величины эффекта),
отравление (враг теряет количество здоровья в единицу времени равное величине эффекта), ослабление (урон наносимый врагу увеличивается на процент величины эффекта).
Все эффекты суммируются.

Враги перемещаются от логова к замку только по дороге.
Расчёт текущего здоровья врага осуществляется в зависимости от эффектов и нанесенного ему урона.
Если здоровье врага становится меньше или равно 0, то он погибает, а замку начисляется запас золота врага.
Если врагу удастся дойти до замка, он наносит ему урон, равный количеству оставшегося здоровья врага, после чего погибает, но золото замку не начисляется.

Разработать приложение, позволяющее описывать состояние игры типа Tower Defense, в которое должно входить информация о врагах, защитных постройках, замке и ландшафте.
Обеспечить загрузку информации о типах врагов, таблицах улучшений и стоимости построек из конфигурационных файлов, загрузку карты из файлов карты,
а также возможность загрузки и сохранения текущего состояния приложения на диск.
Для хранения в памяти информации о врагах, защитных постройках и замке используются соответствующие описатели.

Описатель замка содержит следующую информацию: название замка, текущую и максимальную прочность, количество золота.
Описатель эффекта содержит оставшееся время действия эффекта, тип и величину эффекта.
Описатель врага содержит название, максимальное и текущий запас здоровья, количество золота, скорость передвижения, и таблицу эффектов.
Описатель логова содержит таблицу описателей врагов и время их выхода из логова.
Описатель башни содержит следующую информацию: уровень башни и таблицу характеристик башни соответствующую уровню: стоимость, радиус действия, наносимый урон и скорострельность.
Дополнительно в таблице характеристик присутствует описатель эффекта, накладываемый магической башней.

Ландшафт (уровень) представляет собой таблицу расположения врагов и прямоугольное поле^1, разделенное на клетки: дорога, поле, лес.
Каждая клетка может указывать на описатель строения, стоящего на нём: замок, логова врагов, защитные башни; ловушки.

Обеспечить выполнение как минимум следующих операций, при помощи которых можно реализовать процесс игры:
Для ландшафта (уровня):
 - получение/изменение размеров игрового поля;
 - получение/изменение типа клетки с заданной координатой в процессе конструирования уровня и в процессе игры;
 - проверка корректности уровня (наличие одного замка и минимум одного логова, от всех логов до замка должна быть проложена дорога).

Для врага:
 - сделать очередной ход (приблизиться к замку и рассчитать здоровье).

Для таблицы:
 - получить количество эффектов у врага;
 - добавить эффект врагу в таблицу.

Для башни:
 - повысить уровень башни;
 - нанести урон врагам в соответствии со стратегией.

Для замка
 - нанести урон замку.

Для логова
 - выпустить очередного врага;
 - выпустить очередного врага, если подошло его время выхода из логова.

Для игры
 - совершить ход — передвинуть всех врагов и осуществить выстрел для каждой башни^2.

Примечания:
1. Шаблонный класс - матрица (обращение к элементам matr[i][j]).
2. Указанную операцию реализовать в многопоточном режиме. Каждая группа башен и врагов обрабатывается в отдельном потоке.
3. Расширяемый класс - башня. Необходимо предусмотреть возможность переопределения основных операций башни в новом классе-наследнике
(например, башня с аурой, которая каждый ход накладывает магический эффект на всех врагов, находящихся в некотором радиусе, и при этом не уничтожается).